<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kényszerített Magyar TTS</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; max-width: 600px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 150px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; margin-bottom: 15px; }
        select { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #0078d4; }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 16px; color: white; cursor: pointer; }
        #speakBtn { background: #0078d4; }
        #stopBtn { background: #d11a2a; }
        .status { margin-top: 15px; font-size: 0.85em; color: #666; padding: 10px; background: #eee; border-radius: 5px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Magyar Felolvasó</h2>
    
    <label for="voiceSelect">Hangválasztó (ha üres, az alapértelmezett szólal meg):</label>
    <select id="voiceSelect">
        <option value="">-- Rendszerhang keresése --</option>
    </select>

    <textarea id="textInput">Szia! Ha a fenti lista üres, a kód akkor is megpróbálja a magyar nyelvet kényszeríteni. Próbáld ki a lejátszást!</textarea>

    <div class="btn-group">
        <button id="speakBtn">Lejátszás</button>
        <button id="stopBtn">Stop</button>
    </div>

    <div id="statusMsg" class="status">Állapot: Indításra kész.</div>
</div>

<script>
    const synth = window.speechSynthesis;
    const voiceSelect = document.querySelector('#voiceSelect');
    const speakBtn = document.querySelector('#speakBtn');
    const stopBtn = document.querySelector('#stopBtn');
    const textInput = document.querySelector('#textInput');
    const statusMsg = document.querySelector('#statusMsg');

    let voices = [];

    // Hanglista feltöltése
    function loadVoices() {
        voices = synth.getVoices();
        if (voices.length > 0) {
            voiceSelect.innerHTML = '';
            voices.forEach(voice => {
                const option = document.createElement('option');
                option.value = voice.name;
                option.textContent = `${voice.name} (${voice.lang})`;
                if (voice.lang.includes('hu')) option.selected = true;
                voiceSelect.appendChild(option);
            });
            statusMsg.textContent = "Állapot: Hangok betöltve (" + voices.length + " db).";
        }
    }

    // Események a betöltéshez
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }
    loadVoices();

    // LEJÁTSZÁS LOGIKA
    speakBtn.addEventListener('click', () => {
        // Minden futó beszédet leállítunk előtte
        synth.cancel();

        if (textInput.value.trim() === "") return;

        const utterance = new SpeechSynthesisUtterance(textInput.value);
        
        // 1. Megpróbáljuk a kiválasztott hangot beállítani
        const selectedVoice = voices.find(v => v.name === voiceSelect.value);
        
        if (selectedVoice) {
            utterance.voice = selectedVoice;
            statusMsg.textContent = "Állapot: Felolvasás ezzel: " + selectedVoice.name;
        } else {
            // 2. HA NINCS LISTA (Android hiba), kényszerítjük a magyar nyelvet!
            utterance.lang = 'hu-HU'; 
            statusMsg.textContent = "Állapot: Lista üres, magyar nyelv kényszerítve (hu-HU).";
            console.log("Nincs lista, kényszerített magyar nyelv (hu-HU)");
        }

        utterance.rate = 1.0;
        utterance.pitch = 1.0;

        utterance.onend = () => { statusMsg.textContent = "Állapot: Kész."; };
        utterance.onerror = (e) => { statusMsg.textContent = "Hiba: " + e.error; };

        synth.speak(utterance);
    });

    stopBtn.addEventListener('click', () => {
        synth.cancel();
        statusMsg.textContent = "Állapot: Megállítva.";
    });
</script>

</body>
</html>
